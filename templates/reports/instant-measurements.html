<html>
    <head>

        <!-- Styles -->
        <link rel="stylesheet" href="/static/css/consumption_centers/graphs.css"/>
        <link type="text/css" href="/static/jquery-ui-1.8.23/css/smoothness/jquery-ui-1.8.23.custom.css" rel="stylesheet" />
        <link rel="stylesheet" href="/static/js/external/jqueryUniform/css/uniform.default.css" type="text/css" media="screen" charset="utf-8" />
        <link href="/static/js/external/messi/messi.css" rel="stylesheet" type="text/css" media="screen" />
        <link rel="stylesheet" href="/static/css/ui.spinner.css"/>

        <!-- Scripts -->
        <script type="text/javascript" src="/static/js/external/jquery.tools.min.js"></script>
        <script type="text/javascript" src="/static/jquery-ui-1.8.23/js/jquery-ui-1.8.23.custom.min.js"></script>
        <script type="text/javascript" src="/static/js/external/jqueryUniform/jquery.uniform.min.js"></script>
        <script type="text/javascript" src="/static/js/external/jsapi.js"></script>
        <script type="text/javascript" src="/static/js/functions.js"></script>
        <script src="/static/js/external/messi/messi.min.js"></script>
        <script src="/static/js/external/ui.spinner.min.js"></script>

        <!-- Google Chart -->
        <script type="text/javascript">
            google.load('visualization', '1.1', {packages: ['corechart', 'controls']});
        </script>

        <script type="text/javascript">

            var control = new google.visualization.ControlWrapper({
                'controlType': 'ChartRangeFilter',
                'containerId': 'control',
                'options': {
                    // Filter by the date axis.
                    'filterColumnIndex': 0,
                    'ui': {
                        'enableInteractivity': false,
                        'chartType': 'LineChart',
                        'chartOptions': {
                            'chartArea': {'width': '90%'},
                            'hAxis': {'baselineColor': 'none'}
                        },
                        // Display a single series that shows the closing value of the stock.
                        // Thus, this view has two columns: the date (axis) and the stock value (line series).
                        'chartView': {
                            'columns': [0, 1]
                        },
                        // 1 day in milliseconds = 24 * 60 * 60 * 1000 = 86,400,000
                        //'minRangeSize': 86400000
                        'minRangeSize':3600000
                    }
                }
                // Initial range: 2012-02-09 to 2012-03-20.
                //'state': {'range': {'start': new Date(2012, 9, 8), 'end': new Date(2012, 9, 9)}}
            });

            function drawVisualization() {
                var dashboard = new google.visualization.Dashboard(
                        document.getElementById('dashboard'));

                var chart = new google.visualization.ChartWrapper({
                    'chartType': 'LineChart',
                    'containerId': 'chart',
                    'options': {
                        // Use the same chart area width as the control for axis alignment.
                        'chartArea': {'height': '80%', 'width': '90%'},
                        'hAxis': {'slantedText': false},
                        'vAxis': {'viewWindow': {'min': 0, 'max': 580}},
                        'legend': {'position': 'top', 'alignment': 'center'}
                    }
                });

                //
                // Google Chart
                //
                var data = new google.visualization.DataTable();
                //var columns_display = new Array();
                //var default_colors = new Array();

                    data.addColumn({type:'datetime', role:'domain'}, "From To");
                    data.addColumn('number', "Value");
                    data.addColumn({type:'boolean', role:'certainty'});

                var True = true;
                var False = false;
                var rows_data = {% autoescape off %}{{ rows }}{% endautoescape %};
                //console.log(rows_data);
                for(var row_index = 0; row_index < rows_data.length; row_index++){
                    var row_data = rows_data[row_index];
                    var row_array = new Array();
                    for(var data_index = 0; data_index < row_data.length; data_index++){
                        var data_object = row_data[data_index];
                        var object_datetime = new Date();
                        object_datetime.setTime((data_object['datetime']*1000));
                        //console.log(object_datetime);
                        row_array.push(object_datetime);
                        var object_electric_data = Math.abs(data_object['value']);
                        row_array.push(object_electric_data);
                        var object_certainty = data_object['certainty'];
                        row_array.push(object_certainty);
                    }
                    console.log(row_array);
                    data.addRow(row_array);
                }
                var view = new google.visualization.DataView(data);

                dashboard.bind(control, chart);
                dashboard.draw(view);
            }

            google.setOnLoadCallback(drawVisualization);
        </script>
    </head>

    <body>
        <ul id="compare_interval1" class="fr">
            <li id="hour" {% if granularity == "hour" %} class="active" {% endif %}>1 H</li>
            <li id="day" {% if granularity == "day" %} class="active" {% endif %}>1 D</li>
            <li id="week" {% if granularity == "week" %} class="active" {% endif %}>1 Sem</li>
        </ul>

        <div id="show-controls">
            <ul>
                {% for column in columns %}
                    <li id="column{{ forloop.counter0 }}" class="chart-column chart-column-active" >{{ column.consumer_unit_string }} ({{ column.parameter }})</li>
                {% endfor %}
            </ul>
        </div>

        <!-- dashboard start -->
        <div id="dashboard" class="fl">

            <!-- chart start -->
            <div id="chart">
                <img src="/static/css/images/spinner.gif" alt="cargando" style="display: block; margin: 0 auto; width: 200px;">
            </div>
            <!-- chart end -->

            <!-- control start -->
            <div id="control"></div>
            <!-- control end -->

            <!-- slider-range start -->
            <div id="slider-range">
                <div id="up">
                    <input type="text" class="integer" id="upper_limit" min="{{ limits.min }}" max="{{ limits.max }}" step="0.5"/>
                </div>

                <div id="down">
                    <input type="text" class="integer" id="lower_limit" min="{{ limits.min }}" max="{{ limits.max }}" step="0.5"/>
                </div>
            </div>
            <!-- slider-range end -->

        </div>
        <!-- dashboard end -->
    </body>
</html>