{% extends "base.html" %}
{% block titulo %}
{% if operation == "edit" %}Editar{% else %}Alta de{% endif %} Empresa
{% endblock %}
{% block externalcss %}
<link rel="stylesheet" href="/static/css/forms/main.css" type="text/css" />
<link rel="stylesheet" href="/static/css/forms/rbac_general.css" type="text/css" />
<link rel="stylesheet" href="/static/css/forms/c_centers.css" type="text/css" />
<link type="text/css" href="/static/jquery-ui-1.8.23/css/smoothness/jquery-ui-1.8.23.custom.css" rel="stylesheet" />
{% endblock %}
{% block externaljs %}
<script type="text/javascript" src="/static/jquery-ui-1.8.23/js/jquery-ui-1.8.23.custom.min.js"></script>
<script type="text/javascript">
    var form_valid = true;
    var send_form = 0;
    $(document).ready(function(){
        $("#company_name").focus();
        $(".required").each(function(){
            var _span;
            if ($(this).parent().next()[0].nodeName.toLowerCase() == 'input'){
                $(this).parent().next().blur(function(e){

                    if($.trim(e.delegateTarget.value)==''){

                        _span = "incorrect";
                        form_valid = false;
                    }else{
                        if(/^[A-Za-z0-9ÁÉÍÓÚáéíóuñÑ ]+$/.test(e.delegateTarget.value)){
                            _span = "correct";
                            form_valid = true;
                        }else{
                            _span = "incorrect";
                            form_valid = false;
                        }
                    }

                    var n_span = $("#"+e.delegateTarget.id).next();
                    n_span.removeClass("incorrect");
                    n_span.removeClass("correct");
                    n_span.addClass(_span);
                });
            }else if ($(this).parent().next()[0].nodeName.toLowerCase() == 'select'){
                var id_select = $(this).parent().next().attr('id')
                $("#"+id_select).change(function(e){
                    if($.trim(e.delegateTarget.value)==''){
                        _span = "incorrect";
                        form_valid = false;
                    }else{
                        _span = "correct";
                        form_valid = true;
                    }

                    var n_span =  $("#"+id_select).parent().next();
                    n_span.removeClass("incorrect");
                    n_span.removeClass("correct");
                    n_span.addClass(_span);
                });
            }
        });
        $("#save").click(function(){
            validate_form();
            return send_form == 1;
        });
    });
    function validate_form(){
        if (form_valid){
            var _span;
            var company_name = $("#company_name");
            if(company_name.val()==''){
                _span = "incorrect";
                form_valid = false;
            }else{
                _span = "correct";
            }
            company_name.next().removeClass("incorrect");
            company_name.next().removeClass("correct");
            company_name.next().addClass(_span);

            var cluster = $("#company_cluster");
            if(cluster.val()==''){
                _span = "incorrect";
                form_valid = false;
            }else{
                _span = "correct";
            }
            $("#sel_cluster").removeClass("incorrect").removeClass("correct").addClass(_span);

            var sector = $("#company_sector");
            if(sector.val()==''){
                _span = "incorrect";
                form_valid = false;
            }else{
                _span = "correct";
            }
            $("#sel_sector").removeClass("incorrect").removeClass("correct").addClass(_span);

        }
        if (form_valid){
            send_form++;
        }

        return form_valid
    }
</script>
{% endblock %}

{% block breadcumbs %}

    <div id="bread_crumbs">
    <a href="/profile/{{ request.user.pk }}/" class="fl username">{{ request.user.first_name }} {{ request.user.last_name }}</a>
    <ul>
        <li><a href="/main/">Inicio</a></li>
        <li><a href="/panel_de_control/">Administraci&oacute;n</a></li>
        <li><a href="/buildings/empresas/">Empresas</a></li>
        {% if operation == "edit" %}
        <li>
            Edici&oacute;n de empresas
        </li>
        {% else %}
        <li>Alta de empresas</li>
        {% endif %}

    </ul>

</div>


{% endblock %}


{% block contenido %}

<div id="page_content">
<div id="contenido_interno">
    <h2 id="titulo_form" class="company">
        {% if operation == "edit" %}Edici&oacute;n de{% else %}Alta de{% endif %} empresas
    </h2>


    <div class="divider" id="divider_top">&nbsp;</div>
    <div id="form_container">
        {% if message %}
                <span class="notif {{ type }}">
                    {% autoescape off %}{{ message }}{% endautoescape %}
                    <a href="#" onclick="$(this).parent().remove();">X</a>
                </span>
        {% endif %}
        <p class="description">
            Pid nisi sed dictumst ac ultricies, vut velit pid, nascetur est ac nunc urna amet tempor cum in odio. Ultrices. Urna placerat in auctor, urna.
            <br/>
            Pid eu, nisi egestas. Enim in porttitor, sed nec tempor, cursus dictumst enim? Augue! Porttitor mid, risus cras! Non duis et turpis, adipiscing augue.
        </p>
        <form method="post" action="." enctype="multipart/form-data">
            {% csrf_token %}
            <h3 class="g12">Informaci&oacute;n de la Empresa</h3>
            <div id="company_logo_upload">
                <div id="company_logo">
                    {% if post.cmp_logo %}
                        <img src="/static/media/{{post.cmp_logo}}">
                    {% else %}
                        <img src="/static/css/images/imgs_icns/company_logo.png">
                    {% endif %}
                </div>
                <input type="file" name="logo" id="logo" value="Seleccionar Archivo">
            </div>
            <div id="cluster_fields" class="company_fields">
                <div class="fields_row g12">
                    <label for="company_name" class="g2">Nombre<span class="required">*</span></label>
                    <input type="text" name="company_name" id="company_name" class="g9"
                           value="{{ post.cmp_name }}"
                            />
                    <span></span>
                </div>
                <div class="fields_row g12">
                    <label for="company_description" class="g2">Descripci&oacute;n</label>
                    <textarea rows="5" name="company_description" id="company_description" class="g9">{{ post.cmp_description }}</textarea>
                    <!--<input type="text" name="clusterdescription" id="clusterdescription" class="g9"
                           value="{{ post.clusterdescription }}"
                            />-->
                    <span></span>
                </div>
                <div class="fields_row g12">
                    <label for="company_cluster" class="g2">Grupo de Empresas<span class="required">*</span></label>
                    <select name="company_cluster" id="company_cluster" class="g9">
                        <option value="">Selecciona un grupo de empresas </option>
                        {% if clusters %}
                        {% for cluster in clusters %}
                        <option value="{{cluster.id}}" {% if post.cmp_cluster == cluster.id %} selected {% endif %}>{{ cluster.cluster_name }}</option>
                        {% endfor %}
                        {% endif %}

                    </select>
                    <span id="sel_cluster"></span>
                </div>
                <div class="fields_row g12">
                    <label for="company_sector" class="g2">Tipo de Sector<span class="required">*</span></label>
                    <select name="company_sector" id="company_sector" class="g9">
                        <option value="">Selecciona un tipo de sector </option>
                        {% if sectors %}
                        {% for sector in sectors %}
                        <option value="{{sector.id}}" {% if post.cmp_sector == sector.id %} selected {% endif %}>{{ sector.sectorial_type_name }}</option>
                        {% endfor %}
                        {% endif %}

                    </select>
                    <span id="sel_sector"></span>
                </div>

            </div>

            <div class="buttons g12">
                <button class="aqua_btn" id="save">
                    Guardar
                </button>
            </div>
        </form>

    </div>


</div>
</div>
{% endblock %}