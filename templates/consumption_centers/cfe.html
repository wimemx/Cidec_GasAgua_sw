{% extends "base.html" %}
{% block titulo %}Reportes{% endblock %}
{% block externalcss %}
<link rel="stylesheet" href="/static/css/consumption_centers/graphs.css">
<link rel="stylesheet" href="/static/css/consumption_centers/cfe_bill.css">
<link rel="stylesheet" href="/static/js/external/fancybox/jquery.fancybox.css" type="text/css" />


{% endblock %}
{% block externaljs %}
<script type="text/javascript" src="http://www.google.com/jsapi"></script>
<script type="text/javascript" src="/static/js/external/fancybox/jquery.fancybox.js"></script>
<script type="text/javascript">
    google.load('visualization', '1', {packages: ['corechart']});
</script>
<script type="text/javascript">

    function graphsReload(){
        /* Takes the date in the range inputs and reloads the graph data */

        var f1_init = encodeURIComponent($("#range1_init").val());
        var f1_end = encodeURIComponent($("#range1_end").val());

        if(f1_init != ''){
            var url = "/reportes/cfe/?";
            url += "f1_init=" + f1_init;
            if(f1_end != ''){
                url += "&f1_end="+f1_end;
            }else{
                url += "&f1_end=" + encodeURIComponent(new Date().format("yyyy-mm-dd"));
            }

            window.location.href = url;
        }
    }

    function cfeReload(){

        var month = $("#month_01").val();
        var year = $("#year_01").val();

        var url = '/reportes/cfe_calculos/'
        url += '?month='+month+"&year="+year;

        //$("#cfe_container").append('<img src="/static/css/images/spinner.gif" id="spinner" alt="cargando" style="display: block; margin: 0 auto; width: 200px;">');
        //$('#cfe_container').load(url, function(){$("#spinner").remove();});

        $('#cfe_container').addClass('iframe_spinner');
        makeIframe(url);

    }

    function refresh_iframe_height(){
        // regresca el height del iframe para ajustarse a su conte
        setTimeout("parent.document.getElementById('graphFrame').height = document['body'].offsetHeight;", 1000);
    }
    function makeIframe(src){
        var graphFrame = document.createElement("IFRAME");
        graphFrame.id = "graphFrame";
        graphFrame.src = src;

        $("#cfe_container").html(graphFrame);
        if (navigator.userAgent.indexOf("MSIE") > -1 && !window.opera) {
            graphFrame.onreadystatechange = function(){
                if (graphFrame.readyState == "complete"){
                    $('#cfe_container').removeClass('iframe_spinner');
                }
            };
        } else {
            graphFrame.onload = function(){
                $('#cfe_container').removeClass('iframe_spinner');
            };
        }
        refresh_iframe_height()
    }

    /*
     function drawVisualization() {
     // Create and populate the data table.
     var data = google.visualization.arrayToDataTable([
     ['Mes', 'Base', 'Media', 'Punta'],
     {% for hist in  historico%}
     ['{{ hist.fecha|date:"m/Y" }}', {{ hist.kw_base }}, {{ hist.kw_intermedio }}, {{ hist.kw_punta }}],
     {% endfor %}
     ]);

     // Create and draw the visualization.
     new google.visualization.ColumnChart(document.getElementById('visualization')).
     draw(data,
     {
     width:570, height:325,}
     );
     }


     google.setOnLoadCallback(drawVisualization);*/
</script>
{% endblock %}
{% block document_ready %}

var now3 = new Date();
now3.addDays(-60);
var now4 = new Date();

refresh_iframe_height();

var state = false;

{% endblock %}
{% block contenido %}

<div id="bread_crumbs">
    <ul>
        <li><a href="/main/">Inicio</a></li>
        <li><a href="/reportes/cfe/">Recibo CFE</a></li>
    </ul>
</div>

<div id="contenido_interno">
    <h2 id="titulo_reporte">Reporte de CFE</h2>

    <div class="divider" id="divider_top">&nbsp;</div>

    <div id="types_graphs">
        <ul>
            <li class="active"><a href="#">Reporte CFE</a></li>
        </ul>
    </div>
    <div id="data_container">
        <h3>{{ empresa.building_name }}</h3>

        <input type="hidden" name="empresa_act" id="empresa_act" value="{{ empresa.pk }}"/>
        <div id="datepicker_component">
            <span class="period_tag">Periodo</span>
            {% if month_list %}
            <select name="month_01" id="month_01">
                {% for key,value in month_list.items %}
                <option value="{{key}}" {% if month == key %} selected{% endif %}>{{value}}</option>
                {% endfor %}
            </select>
            {% endif %}
            {% if year %}
            <select name="year_01" id="year_01">
                {% for key,value in year_list.items %}
                <option value="{{key}}" {% if year == key %} selected{% endif %}>{{value}}</option>
                {% endfor %}
            </select>
            {% endif %}

            <button class="aqua_btn" onclick="cfeReload();">Reporte</button>

        </div>
        <div class="vacio"></div>
        <div id="cfe_container">
            <iframe src="/reportes/cfe_calculos/" id="graphFrame"></iframe>
        </div>


    </div>


</div>
{% endblock %}