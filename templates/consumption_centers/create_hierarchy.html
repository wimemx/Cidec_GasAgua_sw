{% extends "base.html" %}
{% block titulo %}Crear jerarqu&iacute;a de partes de edificio y medidores{% endblock %}

{% block externalcss %}
    <link rel="stylesheet" href="/static/css/forms/main.css" type="text/css" />
    <link rel="stylesheet" href="/static/css/forms/c_centers.css" type="text/css" />
    <link rel="stylesheet" href="{{ STATIC_URL }}js/external/jOrgChart/css/jquery.jOrgChart.css"/>
    <link rel="stylesheet" href="/static/css/consumption_centers/consumer_units_tree.css">
    <link rel="stylesheet" href="/static/js/external/fancybox/jquery.fancybox.css" type="text/css" />
{% endblock %}
{% block externaljs %}
    <script type="text/javascript" src="/static/js/external/fancybox/jquery.fancybox.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}jquery-ui-1.8.23/js/jquery-ui-1.8.23.custom.min.js"></script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/external/jOrgChart/jquery.jOrgChart.custom.js"></script>
    <script type="text/javascript">

        function init_tree(){
            var opts = {
                chartElement : '#chart',
                dragAndDrop  : true
            };
            $("#chart").html("");
            $("#org").jOrgChart(opts);
        }
    var click_flag = true;
    </script>
{% endblock %}
{% block document_ready %}
    init_tree();

    $(".del").live("click", function(e){
        var nodo=$(this);
        var texto = $.trim(nodo.parent().parent().find("a:eq(0)").text())

        $("#org").find("li").each(function(index, lista){
            var texto_lista = $.trim($(lista).find("a:eq(0)").text());
            if(texto_lista==texto){
                $(lista).remove();
                init_tree();

            }else{
                return;
            }
        });

    });
    $(".add").live("click", function(){
        click_flag=false;
    }).fancybox({
        maxWidth	: 800,
        maxHeight	: 800,
        fitToView	: false,
        width		: '70%',
        height		: '70%',
        autoSize	: false,
        closeClick	: false,
        openEffect	: 'none',
        closeEffect	: 'none',
        afterClose  : function(){click_flag=true;}
    });
    $("#type_node").change(function(){
        var valor = parseInt($(this).val());
        if (valor > 0){
            if(valor == 1){
                var url = "/buildings/add_partbuilding_pop/{{ building.pk }}/"
                var newwindow=window.open(url,'name','height=600,width=800');
                if (window.focus) {newwindow.focus()}
                return false;
            }else{
                url = "/buildings/get_parts_of_building/"
            }
            $.ajax({
            url: "/buildings/get_parts_of_building/",
            global: false,
            type: "GET",
            dataType: "json",
            statusCode: {
            404: function() {
            $("#notice").before(msg);
            }
            },
            success: function(msg){
            $("#search").val("");
            $("#id_pm").val("");
            var registro = msg[0];
            form_row(registro.pm, registro.alias, registro.marca, registro.modelo, registro.serie, registro.status);
            },
            });
        }

    });
    /*
    $(".add").live("click", function(e){
    var nodo=$(this);
    var texto = $.trim(nodo.parent().parent().find("p:eq(0)").text())

    $("#org").find("li").each(function(index, lista){
    var texto_lista = $.trim($(lista).find("p:eq(0)").text());

    if(texto_lista==texto){
    $(lista).removeClass("temp");
    init_tree();
    return false;
    }
    });

    })
    */


{% endblock %}


{% block contenido %}
    <div id="bread_crumbs">
        <ul>
            <li><a href="/main/">Inicio</a></li>
            <li><a href="/panel_de_control/">Administraci&oacute;n</a></li>
            <li><a href="/buildings/industrial_equipments/">Equipos Industriales</a></li>
            <li>Configurar Equipo Industrial</li>
        </ul>

    </div>
    <div id="contenido_interno" class="card">
        <h2 id="titulo_form" class="powermeter">
            Configurar Jerarqu&iacute;a de Partes y Medidores - {{ building.building_name }}
        </h2>


        <div class="divider" id="divider_top">&nbsp;</div>
        {% if message %}
            <span class="notif {{ msg_type }}">
                    {% autoescape off %}{{ message }}{% endautoescape %}
                    <a href="#" onclick="$(this).parent().remove(); History.replaceState({}, '', ' ');">X</a>
                </span>
        {% endif %}
        <p class="description">
            Pid nisi sed dictumst ac ultricies, vut velit pid, nascetur est ac nunc urna amet tempor cum in odio. Ultrices. Urna placerat in auctor, urna.
            <br/>
            Pid eu, nisi egestas. Enim in porttitor, sed nec tempor, cursus dictumst enim? Augue! Porttitor mid, risus cras! Non duis et turpis, adipiscing augue.
        </p>

        <div class="g12" id="form_container">
            <form action="." method="post">
                {% csrf_token %}
                <div id="hierarchy" class="g12">
                    <div id="chart"></div>
                    {{ list|safe }}
                </div>
                <div id="fancy">
                    <h1 id="title_lb">Crear Nuevo Nodo</h1>
                    <p id="notice">
                        Selecciona que tipo de nodo deseas agregar
                    </p>
                    <div class="g12" id="agregar_nodo">
                        <div class="g4">
                            <label class="g6"> Elija un tipo de nodo</label>
                            <select class="g6" id="type_node">
                                <option value="0">Elija una opci&oacute;n</option>
                                <option value="1">
                                    Parte de edificio
                                </option>
                                <option value="2">
                                    Sistema o dispositivo el&eacute;ctrico
                                </option>
                            </select>
                        </div>
                        <div class="g4 hidden">
                            <label class="g6" id="label_node_part" for="node_part"> Elija un tipo de nodo</label>
                            <select class="g6" id="node_part">
                            </select>
                        </div>

                    </div>
                </div>
            </form>
        </div>
    </div>
{% endblock %}