<html>
<head>

    <link rel="stylesheet" href="/static/css/consumption_centers/graphs.css"/>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript">
        google.load('visualization', '1.1', {packages: ['corechart', 'controls']});
    </script>
    <script type="text/javascript">

        //----------------------CHARTS----------------------------
        var chart, control;
        function drawVisualization() {
            var dashboard = new google.visualization.Dashboard(
                    document.getElementById('dashboard'));

            control = new google.visualization.ControlWrapper({
                'controlType': 'ChartRangeFilter',
                'containerId': 'control',
                'options': {
                    // Filter by the date axis.
                    'filterColumnIndex': 0,
                    'ui': {
                        'chartType': 'LineChart',
                        'chartOptions': {
                            'chartArea': {'width': '90%'},
                            'hAxis': {'baselineColor': 'none'}
                        },
                        // Display a single series that shows the closing value of the stock.
                        // Thus, this view has two columns: the date (axis) and the stock value (line series).
                        'chartView': {
                            'columns': [0, 1]
                        },
                        // 1 day in milliseconds = 24 * 60 * 60 * 1000 = 86,400,000
                        'minRangeSize': 3600000
                    }
                },
                // Initial range: 2012-02-09 to 2012-03-20.
                'state': {'range': {'start': new Date({{ fi|date:"Y,m,d" }}), 'end': new Date({{ ff|date:"Y,m,d" }})}}
            });

            chart = new google.visualization.ChartWrapper({
                'chartType': 'LineChart',
                'containerId': 'chart',
                'options': {
                    // Use the same chart area width as the control for axis alignment.
                    'chartArea': {'height': '80%', 'width': '100%'},
                    'hAxis': {'slantedText': false},
                    'vAxis': {'viewWindow': {'min': 230, 'max': 275}, textPosition: 'in'},
                    'legend': {'position': 'none'}
                },
                'colors': ['#ccc','#000'],
                // Convert the first column from 'date' to 'string'.
                'view': {
                    'columns': [
                        {
                            'calc': function(dataTable, rowIndex) {
                                return dataTable.getFormattedValue(rowIndex, 0);
                            },
                            'type': 'string'
                        }, 1]
                }
            });

            var data = new google.visualization.DataTable();
            data.addColumn('datetime', 'Date');
            data.addColumn('number', 'Potencia Activa');

            // Create random stock values, just like it works in reality.
            var open, close = 300;
            var low;
            {% for kw in main_interval_kw %}
                data.addRow([new Date({{ kw.date|date:"Y,m,d,G,i"}}), {{ kw.kw }}]);
            {% endfor %}

            dashboard.bind(control, chart);
            dashboard.draw(data);
        }


        google.setOnLoadCallback(drawVisualization);

        function changeRange(interval) {



            var start_date = new Date({{ fi|date:"Y,m,d" }});
            var end_date = new Date({{ ff|date:"Y,m,d" }});

            var hour = start_date.getHours();


            switch (interval){
                case 'hour' :
                    end_date = new Date({{ fi|date:"Y,m,d,G" }}+2);
                    break;
                case 'day' :
                    end_date.setDate(start_date.getDate()+1);
                    break;
                case 'week' :
                    end_date.setDate(start_date.getDate()+7);
                    break;
                case 'month' :
                    end_date.setDate(start_date.getDate()+30);
                    break;
            }
            // 'slider' is the ControlWrapper instance describing the range slider.
            control.setState({
                'range': {
                    'start':new Date({{ fi|date:"Y,m,d" }}),
                    'end': end_date
                }
            });
            control.draw();
        }

        $(document).ready(function(){
            $("#compare_interval li").each(function(){
                //cambia el intervalo visible de las graficas y cambia el estilo segun la opcion seleccionada
                $(this).click(function(){
                    changeRange($(this).attr('id'));
                    $("#compare_interval li").each(function(){
                        $(this).removeClass("active");
                    });
                    $(this).addClass("active");
                });
            });
        });
    </script>
</head>

<body>
    <ul id="compare_interval" class="fr">
        <li id="hour">Hora</li>
        <li id="day">D&iacute;a</li>
        <li id="week" class="active">Semana</li>
        <li id="month">Mes</li>
    </ul>
    <div id="dashboard" class="fl">
        <div id="chart"></div>
        <div id="control"></div>
    </div>
</body>
</html>