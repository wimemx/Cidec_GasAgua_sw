{% extends "base.html" %}
{% block titulo %}Asistente para nueva instalaci√≥&oacute;n{% endblock %}
{% block externalcss %}
    <!--suppress HtmlUnknownTarget -->
    <link rel="stylesheet" href="/static/css/consumption_centers/main.css" type="text/css" />
    <link href="/static/js/external/techlab-SmartWizard-1636c86/styles/smart_wizard.css" rel="stylesheet" type="text/css">
    <link rel="stylesheet" href="/static/js/external/fancybox/jquery.fancybox.css" type="text/css" />
{% endblock %}
{% block externaljs %}
<script type="text/javascript" src="/static/js/external/techlab-SmartWizard-1636c86/js/jquery.smartWizard-2.0.min.js"></script>
<script type="text/javascript" src="/static/js/external/fancybox/jquery.fancybox.js"></script>
<script type="text/javascript">
$(document).ready(function(){
    	// Smart Wizard
  	  $('#wizard').smartWizard({transitionEffect:'slideleft',onLeaveStep:leaveAStepCallback,onFinish:onFinishCallback,enableFinishButton:true});

      function leaveAStepCallback(obj){
        var step_num= obj.attr('rel');
        return validateSteps(step_num);
      }

      function onFinishCallback(){
       if(validateAllSteps()){
        $('form').submit();
       }
      }
		});

    function validateAllSteps(){
       var isStepValid = true;

       if(validateStep1() == false){
         isStepValid = false;
         $('#wizard').smartWizard('setError',{stepnum:1,iserror:true});
       }else{
         $('#wizard').smartWizard('setError',{stepnum:1,iserror:false});
       }

       if(validateStep3() == false){
         isStepValid = false;
         $('#wizard').smartWizard('setError',{stepnum:3,iserror:true});
       }else{
         $('#wizard').smartWizard('setError',{stepnum:3,iserror:false});
       }

       if(!isStepValid){
          $('#wizard').smartWizard('showMessage','Please correct the errors in the steps and continue');
       }

       return isStepValid;
    }


    function validateSteps(step){
        var wizard = $('#wizard');
        var isStepValid = true;
        // validate step 1
        if(step == 1){
            if(validateStep1() == false ){
                isStepValid = false;
                wizard.smartWizard('showMessage','Please correct the errors in step'+step+ ' and click next.');
                wizard.smartWizard('setError',{stepnum:step,iserror:true});
            }else{
                wizard.smartWizard('setError',{stepnum:step,iserror:false});
            }
        }
        // validate step3
        if(step == 3){
            if(validateStep3() == false ){
                isStepValid = false;
                wizard.smartWizard('showMessage','Please correct the errors in step'+step+ ' and click next.');
                wizard.smartWizard('setError',{stepnum:step,iserror:true});
            }else{
                wizard.smartWizard('setError',{stepnum:step,iserror:false});
            }
        }

        return isStepValid;
    }
    function validateStep1(){
        var isValid = true;
        //validate

        return isValid;
    }
    function validateStep3(){
        var isValid = true;
        //validate

        return isValid;
    }
</script>

{% endblock %}
{% block document_ready %}
    $(".add").fancybox({
    maxWidth	: 800,
        maxHeight	: 800,
        fitToView	: false,
        width		: '70%',
        height		: '70%',
        autoSize	: false,
        closeClick	: false,
        openEffect	: 'none',
        closeEffect	: 'none',
        afterClose  : function(){click_flag=true;}
    });
{% endblock %}
{% block breadcumbs %}

     <div id="bread_crumbs">
     <a href="/profile/{{ request.user.pk }}/" class="fl username">{{ request.user.first_name }} {{ request.user.last_name }}</a>
        <ul>
            <li><a href="/main/">Inicio</a></li>
            <li>Alta de estructura inicial</li>
        </ul>
    </div>

{% endblock %}

{% block contenido %}

    <div id="page_content">
        <div id="contenido_interno">
            <h2 class="titulo_reporte"><span class="building">Alta de estrictura inicial</span></h2>

            <div class="divider" id="divider_top">&nbsp;</div>
            {% if message %}
                <span class="notif {{ msg_type }}">
                    {% autoescape off %}{{ message }}{% endautoescape %}
                <a href="#" onclick="$(this).parent().remove();">X</a>
                </span>
            {% endif %}

            <div id="content">
                <form method="post" action=".">
                <div id="wizard" class="swMain">
                    <ul>
                        <li>
                            <a href="#step-1">
                                <span class="stepNumber">1</span>
                                <span class="stepDesc">
                                    <small>Ubicaci&oacute;n de la instalaci&oacute;n</small>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="#step-2">
                                <span class="stepNumber">2</span>
                                <span class="stepDesc">
                                    <small>Estructura de la instalaci&oacute;n</small>
                                </span>
                            </a>
                        </li>
                        <li>
                            <a href="#step-3">
                            <span class="stepNumber">3</span>
                            <span class="stepDesc">
                                <small>Usuarios y permisos</small>
                            </span>
                            </a>
                        </li>
                        </li>
                        <li>
                            <a href="#step-4">
                                <span class="stepNumber">4</span>
                                <span class="stepDesc">
                                    <small>Alarmas</small>
                                </span>
                            </a>
                        </li>
                    </ul>

                    <div id="step-1">
                        <div class="form_content">
                            <label for="company_cluster" class="g2">Grupo de Empresas<span class="required">*</span></label>
                            <select name="company_cluster" id="company_cluster" class="g9">
                                <option value="">Selecciona un grupo de empresas </option>
                                {% if clusters %}
                                {% for cluster in clusters %}
                                <option value="{{cluster.id}}" {% if post.cmp_cluster == cluster.id %} selected {% endif %}>{{ cluster.cluster_name }}</option>
                                {% endfor %}
                                {% endif %}

                            </select>
                            <a href="/buildings/add_cluster_pop/" class="add">Agregar Cluster</a>
                        </div>
                    </div>
                    <div id="step-2">

                    </div>
                    <div id="step-3">

                    </div>
                    <div id="step-4">

                    </div>


                </div>
                </form>
            </div>
        </div>
    </div>
{% endblock %}
